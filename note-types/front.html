<div class="card-inner">
<div class="front">
    <div class="audio-row">
        <div class="audio-item fi" style="--d:0">
            {{Word Audio}}
            <span class="audio-label">Word</span>
        </div>
        <div class="audio-item fi" style="--d:70">
            {{Sentence Audio}}
            <span class="audio-label">Sentence</span>
        </div>
    </div>
</div>

<script>
(function() {
  var HANDLER_KEY = '__audioHandler';
  function getSounds(item) {
    if (!item) return [];
    var sounds = [];
    item.querySelectorAll('.soundLink').forEach(function(link) {
      var m = (link.getAttribute('onclick') || '').match(/play:([^'")\s]+)/);
      if (m) sounds.push(m[1]);
    });
    return sounds;
  }
  function animateBtn(btn) {
    var circle = btn.querySelector('circle, .replayCircle');
    var path = btn.querySelector('path, .replayTriangle');
    btn.style.transform = 'scale(0.95)';
    btn.style.transitionDuration = '80ms';
    if (circle) { circle.style.fill = 'var(--bg-surface-hover)'; circle.style.stroke = 'var(--accent-glow)'; }
    if (path) { path.style.fill = 'var(--accent)'; }
    setTimeout(function() { btn.style.transform = 'scale(1.06)'; btn.style.transitionDuration = ''; }, 100);
    setTimeout(function() {
      btn.style.transform = '';
      if (circle) { circle.style.fill = ''; circle.style.stroke = ''; }
      if (path) { path.style.fill = ''; }
    }, 350);
  }
  function play(item) {
    var sounds = getSounds(item);
    if (!sounds.length) return;
    sounds.forEach(function(f) { try { pycmd('play:' + f); } catch(e) {} });
    item.querySelectorAll('.replay-button').forEach(animateBtn);
  }
  function handler(ev) {
    var el = ev.target;
    if (el && (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA' || el.isContentEditable)) return;
    var items = document.querySelectorAll('.audio-row .audio-item');
    switch (ev.key.toLowerCase()) {
      case 'n': ev.preventDefault(); ev.stopPropagation(); play(items[0]); break;
      case 'h': ev.preventDefault(); ev.stopPropagation(); play(items[1]); break;
    }
  }
  if (window[HANDLER_KEY]) {
    window.removeEventListener('keydown', window[HANDLER_KEY], true);
  }
  window[HANDLER_KEY] = handler;
  window.addEventListener('keydown', handler, { capture: true });
})();
</script>
</div>
